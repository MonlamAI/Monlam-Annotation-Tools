# Render Blueprint for Monlam Doccano
# https://render.com/docs/blueprint-spec

services:
  # ===========================================
  # Main Doccano Web Service
  # ===========================================
  - type: web
    name: monlam-doccano
    env: docker
    plan: standard  # 2GB RAM - change to 'pro' for 4GB
    region: singapore
    healthCheckPath: /
    envVars:
      # Admin credentials
      - key: ADMIN_USERNAME
        value: admin
      - key: ADMIN_EMAIL
        value: admin@monlam.ai
      - key: ADMIN_PASSWORD
        sync: false  # Set manually in dashboard for security
      
      # Database - auto-linked from PostgreSQL service
      - key: DATABASE_URL
        fromDatabase:
          name: doccano-db
          property: connectionString
      
      # Redis - auto-linked from Redis service
      - key: CELERY_BROKER_URL
        fromService:
          name: doccano-redis
          type: redis
          property: connectionString
      
      # Django settings
      - key: DJANGO_SETTINGS_MODULE
        value: config.settings.production
      - key: DEBUG
        value: "False"
      - key: ALLOW_SIGNUP
        value: "False"
      
      # Secret key - generate a unique one
      - key: SECRET_KEY
        generateValue: true

  # ===========================================
  # PostgreSQL Database
  # ===========================================
databases:
  - name: doccano-db
    plan: starter  # $7/month, 1GB storage
    databaseName: doccano
    user: doccano

  # ===========================================
  # Redis for Celery Task Queue
  # ===========================================
  - type: redis
    name: doccano-redis
    plan: starter  # $10/month
    maxmemoryPolicy: allkeys-lru

