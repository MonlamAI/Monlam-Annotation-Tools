# Render.com Blueprint for Monlam Annotation Tools
# 
# This replaces existing Doccano deployment.
# Uses EXISTING PostgreSQL and RabbitMQ from your current Render setup.
# Just push to the connected GitHub repo - Render will auto-deploy.

services:
  - type: web
    name: monlam-doccano
    env: docker
    dockerfilePath: ./Dockerfile
    dockerContext: .
    plan: starter
    region: singapore
    branch: main
    autoDeploy: true
    
    healthCheckPath: /health/
    
    # Environment variables - override old Doccano settings
    envVars:
      # IMPORTANT: Override old Doccano settings module
      - key: DJANGO_SETTINGS_MODULE
        value: "config.settings"
      
      - key: DEBUG
        value: "False"
      
      - key: ALLOWED_HOSTS
        value: ".onrender.com"
      
      - key: USE_S3
        value: "False"
      
      # These should already exist in your Render service:
      # - DATABASE_URL (from existing PostgreSQL)
      # - CELERY_BROKER_URL (from existing RabbitMQ)
      # - SECRET_KEY

    startCommand: |
      python manage.py migrate --noinput && \
      gunicorn config.wsgi:application --bind 0.0.0.0:$PORT --workers 2 --threads 2

    disk:
      name: media
      mountPath: /app/media
      sizeGB: 10

# No databases section - using your existing PostgreSQL
# No additional services - using your existing RabbitMQ

