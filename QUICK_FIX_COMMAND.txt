# Quick Fix Command for Render
# Run this in Render Shell:

python3 << 'PYTHON_SCRIPT'
import urllib.request
import os
import shutil
from datetime import datetime

# Find the views.py file
possible_paths = [
    '/doccano/backend/monlam_ui/views.py',
    '/doccano/backend/patches/monlam_ui/views.py',
    '/doccano/monlam_ui/views.py',
]

views_path = None
for path in possible_paths:
    if os.path.exists(path):
        views_path = path
        break

if not views_path:
    print("âŒ Could not find views.py file!")
    print("Searched in:", possible_paths)
    exit(1)

print(f"âœ… Found file at: {views_path}")

# Backup
backup_path = f'{views_path}.backup.{datetime.now().strftime("%Y%m%d_%H%M%S")}'
shutil.copy2(views_path, backup_path)
print(f"âœ… Backup created: {backup_path}")

# Download fixed version
url = 'https://raw.githubusercontent.com/MonlamAI/Monlam-Annotation-Tools/main/patches/monlam_ui/views.py'
urllib.request.urlretrieve(url, views_path)
print(f"âœ… Downloaded updated file")

# Verify fix
with open(views_path, 'r') as f:
    content = f.read()
    if "t.status in ['submitted', 'reviewed', 'rejected']" in content:
        print(f"âœ… Fix verified!")
        print(f"\nðŸŽ‰ SUCCESS! Payment fix applied.")
        print(f"   Next: Restart Render service and check analytics dashboard.")
    else:
        print(f"âš ï¸  Fix not found - restoring backup...")
        shutil.copy2(backup_path, views_path)
        exit(1)
PYTHON_SCRIPT

