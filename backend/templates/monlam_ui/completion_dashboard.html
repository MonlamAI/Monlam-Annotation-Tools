{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Completion Dashboard - {{ project.name }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vuetify@2.7.1/dist/vuetify.min.css">
    <style>
        @font-face {
            font-family: 'MonlamTBslim';
            src: url('{% static "fonts/MonlamTBslim.woff2" %}') format('woff2'),
                 url('{% static "fonts/MonlamTBslim.woff" %}') format('woff'),
                 url('{% static "fonts/MonlamTBslim.ttf" %}') format('truetype');
            font-weight: 100 900;
            font-style: normal;
            font-display: swap;
        }
        
        body, * {
            font-family: 'MonlamTBslim', 'Noto Sans Tibetan', -apple-system, BlinkMacSystemFont, sans-serif !important;
        }
        
        :root {
            --monlam-gold: #B8963E;
            --monlam-gold-dark: #9A7B32;
            --monlam-navy: #1a1a2e;
        }
        
        .monlam-header {
            background: var(--monlam-navy) !important;
        }
        
        .monlam-gold {
            color: var(--monlam-gold) !important;
        }
        
        .monlam-gold-bg {
            background-color: var(--monlam-gold) !important;
        }
        
        .stat-card {
            transition: transform 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
        }
        
        .progress-bar {
            height: 24px;
            border-radius: 12px;
            overflow: hidden;
            background: #e0e0e0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--monlam-gold), var(--monlam-gold-dark));
            border-radius: 12px;
            transition: width 0.5s ease;
        }
        
        .status-pending { background-color: #e0e0e0; color: #666; }
        .status-in_progress { background-color: #2196f3; color: white; }
        .status-submitted { background-color: #ff9800; color: white; }
        .status-approved { background-color: #4caf50; color: white; }
        .status-rejected { background-color: #f44336; color: white; }
    </style>
</head>
<body>
    <div id="app">
        <v-app>
            <!-- Header -->
            <v-app-bar app dark class="monlam-header" elevation="2">
                <v-btn icon href="/projects/{{ project.id }}/">
                    <v-icon>mdi-arrow-left</v-icon>
                </v-btn>
                <v-toolbar-title>
                    <span class="monlam-gold">{{ project.tibetan_name|default:project.name }}</span>
                    <span class="ml-2 caption">- Completion Dashboard</span>
                </v-toolbar-title>
                <v-spacer></v-spacer>
            </v-app-bar>
            
            <v-main class="grey lighten-4">
                <v-container fluid class="pa-6">
                    <!-- Overall Progress -->
                    <v-card class="mb-6" elevation="2">
                        <v-card-title class="monlam-gold">
                            üìä Overall Progress
                        </v-card-title>
                        <v-card-text>
                            <div class="progress-bar mb-4">
                                <div class="progress-fill" style="width: {{ stats.completion_rate }}%"></div>
                            </div>
                            <div class="text-center text-h4 monlam-gold mb-4">
                                {{ stats.completion_rate }}% Complete
                            </div>
                            
                            <v-row>
                                <v-col cols="12" sm="6" md="2">
                                    <v-card class="stat-card text-center pa-4" color="grey lighten-3">
                                        <div class="text-h4">{{ stats.total }}</div>
                                        <div class="caption">Total</div>
                                    </v-card>
                                </v-col>
                                <v-col cols="12" sm="6" md="2">
                                    <v-card class="stat-card text-center pa-4 status-pending">
                                        <div class="text-h4">{{ stats.pending }}</div>
                                        <div class="caption">Pending</div>
                                    </v-card>
                                </v-col>
                                <v-col cols="12" sm="6" md="2">
                                    <v-card class="stat-card text-center pa-4 status-in_progress">
                                        <div class="text-h4">{{ stats.in_progress }}</div>
                                        <div class="caption">In Progress</div>
                                    </v-card>
                                </v-col>
                                <v-col cols="12" sm="6" md="2">
                                    <v-card class="stat-card text-center pa-4 status-submitted">
                                        <div class="text-h4">{{ stats.submitted }}</div>
                                        <div class="caption">Submitted</div>
                                    </v-card>
                                </v-col>
                                <v-col cols="12" sm="6" md="2">
                                    <v-card class="stat-card text-center pa-4 status-approved">
                                        <div class="text-h4">{{ stats.approved }}</div>
                                        <div class="caption">Approved</div>
                                    </v-card>
                                </v-col>
                                <v-col cols="12" sm="6" md="2">
                                    <v-card class="stat-card text-center pa-4 status-rejected">
                                        <div class="text-h4">{{ stats.rejected }}</div>
                                        <div class="caption">Rejected</div>
                                    </v-card>
                                </v-col>
                            </v-row>
                        </v-card-text>
                    </v-card>
                    
                    <v-row>
                        <!-- Annotator Performance -->
                        <v-col cols="12" md="6">
                            <v-card elevation="2">
                                <v-card-title class="monlam-gold">
                                    ‚úçÔ∏è Annotator Performance
                                </v-card-title>
                                <v-card-text>
                                    <v-simple-table>
                                        <thead>
                                            <tr>
                                                <th>Annotator</th>
                                                <th class="text-right">Completed</th>
                                                <th class="text-right">Approved</th>
                                                <th class="text-right">Rejected</th>
                                                <th class="text-right">Success Rate</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for annotator in annotators %}
                                            <tr>
                                                <td>{{ annotator.username }}</td>
                                                <td class="text-right">{{ annotator.completed }}</td>
                                                <td class="text-right text-success">{{ annotator.approved }}</td>
                                                <td class="text-right text-error">{{ annotator.rejected }}</td>
                                                <td class="text-right">
                                                    <v-chip small :color="annotator.success_rate >= 90 ? 'success' : annotator.success_rate >= 70 ? 'warning' : 'error'" text-color="white">
                                                        {{ annotator.success_rate }}%
                                                    </v-chip>
                                                </td>
                                            </tr>
                                            {% empty %}
                                            <tr>
                                                <td colspan="5" class="text-center grey--text">No annotations yet</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </v-simple-table>
                                </v-card-text>
                            </v-card>
                        </v-col>
                        
                        <!-- Reviewer Performance -->
                        <v-col cols="12" md="6">
                            <v-card elevation="2">
                                <v-card-title class="monlam-gold">
                                    ‚úÖ Reviewer Performance
                                </v-card-title>
                                <v-card-text>
                                    <v-simple-table>
                                        <thead>
                                            <tr>
                                                <th>Reviewer</th>
                                                <th class="text-right">Reviewed</th>
                                                <th class="text-right">Approved</th>
                                                <th class="text-right">Rejected</th>
                                                <th class="text-right">Approval Rate</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for reviewer in reviewers %}
                                            <tr>
                                                <td>{{ reviewer.username }}</td>
                                                <td class="text-right">{{ reviewer.reviewed }}</td>
                                                <td class="text-right text-success">{{ reviewer.approved }}</td>
                                                <td class="text-right text-error">{{ reviewer.rejected }}</td>
                                                <td class="text-right">
                                                    <v-chip small color="primary" text-color="white">
                                                        {{ reviewer.approval_rate }}%
                                                    </v-chip>
                                                </td>
                                            </tr>
                                            {% empty %}
                                            <tr>
                                                <td colspan="5" class="text-center grey--text">No reviews yet</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </v-simple-table>
                                </v-card-text>
                            </v-card>
                        </v-col>
                    </v-row>
                    
                    <!-- Actions -->
                    <v-card class="mt-6" elevation="2">
                        <v-card-actions>
                            <v-btn color="primary" href="/projects/{{ project.id }}/">
                                <v-icon left>mdi-arrow-left</v-icon>
                                Back to Project
                            </v-btn>
                            <v-spacer></v-spacer>
                            <v-btn outlined color="primary" @click="exportReport">
                                <v-icon left>mdi-download</v-icon>
                                Export Report
                            </v-btn>
                        </v-card-actions>
                    </v-card>
                </v-container>
            </v-main>
        </v-app>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.7.1/dist/vuetify.min.js"></script>
    <script>
        new Vue({
            el: '#app',
            vuetify: new Vuetify({
                theme: {
                    themes: {
                        light: {
                            primary: '#B8963E',
                            secondary: '#1a1a2e',
                        }
                    }
                }
            }),
            methods: {
                exportReport() {
                    window.location.href = '/monlam/{{ project.id }}/completion/api/?format=csv';
                }
            }
        });
    </script>
</body>
</html>

