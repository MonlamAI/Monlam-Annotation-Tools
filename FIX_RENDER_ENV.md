# ğŸ”§ Fix Render Environment Variables - Step by Step

## ğŸ¯ **THE PROBLEM**

You manually set `DJANGO_SETTINGS_MODULE=config.settings` in Render, which:
- âŒ Overrides the Dockerfile
- âŒ Points to non-existent settings file
- âŒ Causes Django to use dummy database backend
- âŒ Results in "settings.DATABASES is improperly configured"

---

## âœ… **THE FIX (2 Minutes)**

### **Step 1: Open Render Dashboard**
1. Go to https://dashboard.render.com
2. Click your **Web Service** (monlam-doccano or similar)
3. Click **Environment** tab (left sidebar)

### **Step 2: Find & Delete Bad Variable**
Look for this entry:
```
DJANGO_SETTINGS_MODULE        config.settings        [Edit] [Delete ğŸ—‘ï¸]
```

**Click the trash icon ğŸ—‘ï¸ to DELETE it**

### **Step 3: Save & Deploy**
1. Click **Save Changes** (top right)
2. Render will auto-deploy with correct settings
3. Wait ~10 minutes for deployment

---

## ğŸ“‹ **CORRECT Environment Variables**

After deletion, you should ONLY have these:

```bash
# âœ… Auto-generated by Render (don't touch):
DATABASE_URL=postgres://user:pass@host:5432/db
PORT=10000

# âœ… Optional (for admin user creation):
ADMIN_USERNAME=admin
ADMIN_PASSWORD=your-secure-password
ADMIN_EMAIL=admin@monlam.ai

# âœ… Security (recommended):
SECRET_KEY=your-secret-key-here
DEBUG=False

# âŒ DELETE THIS:
DJANGO_SETTINGS_MODULE=config.settings  â† DELETE!
```

---

## ğŸ” **Verify It's Fixed**

After saving, check deployment logs for:

### **âœ… SUCCESS:**
```
==> Deploying...
ğŸ” DATABASE_URL: postgres://...
ğŸ Django Settings: config.settings.production  â† Correct!
Running migrations:
  Applying contenttypes.0001_initial... OK
  Applying auth.0001_initial... OK
  ...
[INFO] Listening at: http://0.0.0.0:10000
==> Live âœ…
```

### **âŒ STILL WRONG:**
```
django.core.exceptions.ImproperlyConfigured: 
settings.DATABASES is improperly configured
```
â†’ The variable wasn't deleted properly. Try again.

---

## ğŸ†˜ **Alternative: Use Diagnostic Script**

If you're not sure what's set, run this in **Render Shell**:

```bash
# Copy the diagnostic script:
curl -s https://raw.githubusercontent.com/MonlamAI/Monlam-Annotation-Tools/main/CHECK_ENV_VARS.sh | bash

# Or if already deployed:
cd /doccano/backend
bash /doccano/backend/../../CHECK_ENV_VARS.sh
```

**Or manually check:**
```bash
# In Render Shell:
echo "DJANGO_SETTINGS_MODULE: $DJANGO_SETTINGS_MODULE"
echo "DATABASE_URL exists: ${DATABASE_URL:+YES}"

# Should output:
# DJANGO_SETTINGS_MODULE: config.settings.production
# DATABASE_URL exists: YES
```

---

## ğŸ“ **Why This Happens**

**Environment variables override Dockerfile:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Priority (highest to lowest):          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Render Environment Variables  ğŸ‘‘    â”‚  â† You set config.settings here
â”‚ 2. Dockerfile ENV statements            â”‚  â† Sets config.settings.production
â”‚ 3. Doccano defaults                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Solution:** Delete from #1 so #2 can work!

---

## ğŸ“¸ **Visual Guide**

### **Before (Wrong):**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Environment                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ DATABASE_URL            postgres://... â•‘
â•‘ PORT                    10000          â•‘
â•‘ DJANGO_SETTINGS_MODULE  config.settingsâ•‘ âŒ DELETE THIS!
â•‘                                        â•‘
â•‘ [+ Add Environment Variable]          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### **After (Correct):**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Environment                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ DATABASE_URL            postgres://... â•‘ âœ…
â•‘ PORT                    10000          â•‘ âœ…
â•‘ ADMIN_USERNAME          admin          â•‘ âœ…
â•‘ ADMIN_PASSWORD          ********       â•‘ âœ…
â•‘                                        â•‘
â•‘ [+ Add Environment Variable]          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## â±ï¸ **Timeline After Fix**

- **Now:** Delete `DJANGO_SETTINGS_MODULE` from Render
- **+1 min:** Click "Save Changes"
- **+2 min:** Auto-deploy starts
- **+12 min:** Should be Live âœ…

---

## âœ… **Checklist**

- [ ] Opened Render Dashboard â†’ Web Service
- [ ] Clicked "Environment" tab
- [ ] Found `DJANGO_SETTINGS_MODULE` entry
- [ ] Clicked trash icon ğŸ—‘ï¸ to delete it
- [ ] Clicked "Save Changes"
- [ ] Waited for auto-deploy to complete
- [ ] Checked logs for "config.settings.production"
- [ ] Site is Live at https://annotate.monlam.ai

---

## ğŸ‰ **After It's Working**

You can then follow **DATABASE_RESET_COMMANDS.md** if you need to reset the database.

---

**Created:** 2026-01-07  
**Fix Time:** 2 minutes  
**Deploy Time:** 10 minutes  
**Total:** 12 minutes to working app âœ…

